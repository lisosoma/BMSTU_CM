# Интерполяция в условиях измерений с неопределенностью

## Базовая часть:

  1. Разработать функцию `qubic_spline_coeff(x_nodes, y_nodes)`, которая посредством решения матричного уравнения вычисляет коэффициенты естественного кубического сплайна.
  2. Написать функции `qubic_spline(x, x_nodes, qs_coeff)` и `d_qubic_spline(x, x_nodes, qs_coeff)`, которые вычисляют соответственно значение кубического сплайна и его производной в точке `x` (`qs_coeff` обозначает матрицу коэффициентов).
  3. Используя данные в таблице 1, требуется построить аппроксимацию зависимости уровня поверхности жидкости $h(x)$ от координаты $x$ (рис. 1) с помощью кубического сплайна и продемонстрировать ее на графике вместе с исходными узлами.
[title1](рис1.png)
Рисунок 1. Поверхность вязкой жидкости (серая кривая), движущейся сквозь некоторую среду (например, пористую). Её значения известнытолько в нескольких точках (красные узлы)
Таблица 1: Значения уровня поверхности вязкой жидкости

|  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | 
| x_i | 0.0 | 0.1 | 0.2 | 0.3 | 0.4 | 0.5 | 0.6 | 0.7 | 0.8 | 0.9 | 1.0 |
| h_i | 3.37 | 3.95 | 3.73 | 3.59 | 3.15 | 3.15 | 3.05 | 3.86 | 3.60 | 3.70 | 3.02 |

## Продвинутая часть:

\\
1. Разработать функцию l_i(i, x, x_nodes), которая возвращает значение i-го базисного полинома Лагранжа, заданного на узлах с абсциссами x_nodes, в точке x.

\\
2. Написать функцию L(x, x_nodes, y_nodes), которая возвращает значение интерполяционного полинома Лагранжа, заданного на узлах с абсциссами x_nodes и ординатами y_nodes, в точке x.

\\
3. Известно, что при измерении координаты $x$ всегда возникает погрешность, которая моделируется случайной величиной с нормальным распределением с нулевым математическим ожиданием и стандартным отклонением $10^{-2}$. Требуется провести следующий анализ, позволяющий выявить влияние этой погрешности на интерполяцию:

\\
a) Сгенерировать 1000  векторов значений $[ \tilde x_1,..., \tilde x_{11}]^T$ предполагая, что $\tilde x_i = x_i + Z$, где $x_i$ соответствует значению в таблице 1 и $Z$ является случайной величиной с нормальным распределением с нулевым математическим ожиданием и стандартным отклонением $10^{-2}$.

\\
b) Для каждого из полученных векторов построить интерполянт Лагранжа, предполагая, что в качестве абсцисс узлов используются значения $\tilde x_i$, а ординат -- $h_i$ из таблицы 1. В результате вы должны иметь 1000 различных интерполянтов.

\\
c) Предполагая, что все интерполянты представляют собой равновероятные события, построить такие функции $\tilde h_l(x)$ и $\tilde h_u(x)$, где $\tilde h_l(x) < \tilde h_u(x) \ \forall x \in [0, 1]$, что вероятность того, что значение интерполянта в точке будет лежать в интервале $[\tilde h_l(x) , \  \tilde h_u(x)]$, равна 0.9.

\\
d) Отобразить на едином графике функции $h_l(x), \ h_u(x)$, усредненный интерполянт и узлы из таблицы 1.

\\
e) Какие участки интерполянта и почему являются наиболее чувствительными к погрешностям?

\\
4. Повторить анализ, описанный в предыдущем пункте, в предположении, что координаты $x_i$ вам известны точно, в то время как измерения уровня поверхности $h_i$ имеют ту же погрешность, что и в предыдущем пункте. Изменились ли выводы вашего анализа?

\\
5. Повторить два предыдущие пункта для случая интерполяции кубическим сплайном. Какие выводы вы можете сделать, сравнив результаты анализа для интерполяции Лагранжа и интерполяции кубическим сплайном?
\newpage

%----------------------------------------------------------
\subsection{Цель выполнения лабораторной работы}

В базовой части данной работы предлагается познакомиться с интерполяцией в целом на примере интерполяции кубическим сплайном.

\\
В продвинутой части предлагается проанализировать, как неопределенности влияют на результат интерполяции, используя интерполяцию сплайном и интерполяцию полиномом Лагранжа, и сравнить результаты анализа для двух указанных методов.
%----------------------------------------------------------
\subsection{Выполненные задачи}
1. На языке программирования Python была написана функция, вычисляющая коэффициенты естественного кубического сплайна.

\\
2. На языке программирования Python были написаны две функции: первая вычисляет значение кубического сплайна в заданной точке, вторая вычисляет производную кубического сплайна в заданной точке.

\\
3. Была проведена и продемонстрирована на графике аппроксимация неизвестной зависимости с помощью кубического сплайна по узлам, представленным в таблице 1.

\\
4. На языке программирования Python была написана функция, возвращающая значение $i$-го базисного полинома Лагранжа.

\\
5. На языке программирования Python была написана функция, возвращающая значение в точке $x$ интерполяционного полинома Лагранжа, заданного в узлах, представленных в таблице 1.

\\
6.Был проведен следующий анализ влияния погрешности измерений на интерполяцию:
\begin{itemize}[itemindent=1em]
\item В первой части анализа были подготовлены данные: сгенерированы 1000 векторов узлов с зашумленными данными для всех четырех случаев, предложенных в задании (для интерполянта Лагранжа зашумление данных $x_i$ или $h_i$, аналогично для кубического сплайна). Также в были построены семейства интерполянтов для всех четырех предложенных в задании случаев и продемонстрированы на графиках.
\item Во второй части была построена доверительная полоса с уровнем доверия 0.9 для всех четырех случаев. Был подробно описан и обоснован метод построения такой полосы. Тут же был построен усредненный интерполянт и представлены четыре графика, на которых изображены сразу доверительная полоса и усредненный интерполянт.
\item В третьей части был проведен анализ влияния погрешностей на результаты интерполяции, было выяснено, как разные погрешности влияют на разные методы интерполяции.
\end{itemize}
%----------------------------------------------------------
%----------------------------------------------------------
\subsection{Разработка функции вычисления коэффициентов кубического сплайна}
Кубический сплайн является примером локальной интерполяции, что будет видно далее из его определения, которое понадобится нам для вычисления его коэффициентов.

\\
\noindent\textbf{Опр.} Пусть задана функция $f(x)$ в $n$ интерполяционных узлах $a = x_1, x_2, ..., x_n = b$ на отрезке $[a, b]$. Кубическим сплайном для $f(x)$ называется функция $S(x)$, для которой выполнено следующее:
\begin{itemize}[itemindent=1em]
\item $S(x)$ кусочно задана кубическими многочленами $S_i(x) \ \forall [x_i, x_{i + 1}], \ i \in[1, n - 1]$;
\item $S_i(x_i) = f(x_i), \ S_{i}(x_{i + 1}) = f(x_{i + 1}), \ i \in[1, n - 1]$;
\item $S_i(x_{i+1}) = S_{i+1}(x_{i+1}), \ i \in[1, n - 2]$;
\item $S'_i(x_{i+1}) = S'_{i+1}(x_{i+1}), \ i \in[1, n - 2]$;
\item $S''_i(x_{i+1}) = S''_{i+1}(x_{i+1}), \ i \in[1, n - 2]$;
\item граничные условия $S''(x_1) = S''(x_n) = 0, \ S'(x_1) = f'(x_1), \  S'(x_n) = f'(x_n) $.
\end{itemize}

\\
Кубический полином задается 4 константами, поэтому для кубического сплайна нам необходимо $4(n - 1)$ коэффициентов:
$$S_i(x) = a_i + b_i(x - x_i) + c_i(x - x_i)^2 + d_i(x - x_i)^3. \eqno(1)\ $$

\\
На данном этапе можно заметить, что подход локальной интерполяции, в частности кубическим сплайном,  имеет важное преимущество перед глобальной: увеличение количества узлов не ведет к увеличению степени полинома --  он всегда остается полиномом третьей степени.

\\
Из формулы (1) видно, что $S_i(x_i) = a_i = f(x_i).$ Далее, как было показано в лекциях [1], можно получить следующие рекуррентные формулы для $b_i$ и $d_i$, исходя из определения кубического сплайна.
$$
b_i = \frac{1}{h_i}(a_{i+1} - a_i) - \frac{h_i}{3}(c_{i + 1} + 2c_i), \eqno(2)\
$$
$$
d_i = \frac{c_{i+1} - c_i}{3h_i},\eqno(3)\
$$
где $h_i = x_{i+1} - x_i$.

\\
В итоге для нахождения векторов коэффициентов $b_i$ и $d_i$ необходимо найти вектор коэффициентов $c_i$. Используя формулы из лекций, запишем рекуррентное уравнение относительно $c_{i-1}, c_i$ и $c_{i + 1}$:
$$
 h_{i - 1}c_{i-1} +  2(h_{i} + h_{i - 1})c_i + h_{i}c_{i + 1} =  \frac{3}{h_{i - 1}}(a_i - a_{i  - 1}) - \frac{3}{h_{i - 2}}(a_{i - 1} - a_{i - 2}). \eqno(4)\
$$

\\
Тогда коэффициенты кубического сплайна можно получить, решая следующее матричное уравнение $\textbf{Ac = b, \ c } = [c_1, ..., c_n]^T$:
$$
\left(
    \begin{array}{c c c c c c}
    1 & 0 & ... & ... & ... & 0
    \\
    h_1 \ & \ 2(h_2 + h_1) \ & \ h_2 \ & \ 0 \ & \ ...\  &\  0 
    \\
    0 & h_2 & 2(h_3 + h_2) \ & h_3 & ... & 0 
    \\
    \vdots &\ddots  &\ddots & \ddots &\ddots &\vdots 
    \\
    0 & ... & 0 & h_{n - 2} & 2(h_{n-2} - h_{n - 1}) & h_{n - 1} 
    \\
    0 & ... & ... & ... & ... & 1
    \end{array}
    \right)
    \left(
    \begin{array}{c}
    c_1
    \\
    c_2
    \\
    c_3
    \\
    \vdots  
    \\
    c_{n - 1}
    \\
    c_n
    \end{array}
    \right) = 
$$
$$
= \left(
    \begin{array}{c}
    0
    \\
    \frac{3}{h_2}(a_3 - a_2) - \frac{3}{h_1}(a_2 - a_1) 
    \\
     \frac{3}{h_3}(a_4 - a_3) - \frac{3}{h_2}(a_3 - a_2)
    \\
    \vdots 
    \\
    \frac{3}{h_{n - 1}}(a_n - a_{n  - 1}) - \frac{3}{h_{n - 2}}(a_{n - 1} - a_{n - 2})
    \\
    0 
    \end{array}
    \right),
$$
где $$h_i = x_{i+1} - x_i.  \eqno(5) $$

\\
Решим данную систему методом прогонки [2], полагая что $c_{i} = z_i - \mu_i c_{i+1}$ и $\frac{3}{h_{i}}(a_{i+1} - a_{i}) - \frac{3}{h_{i - 1}}(a_{i} - a_{i - 1}) = \alpha_i$. Тогда выразим $c_{i - 1}$ через $c_{i + 1}$:
$$
c_{i - 1} = z_{i - 1} - \mu_{i - 1}c_i = z_{i - 1} - \mu_{i - 1}z_i + \mu_{i - 1}\mu_i c_{i+1},
$$
подставим $a_{i-1}, c_{i-1}, c_{i}$ в (4):
$$
 h_{i - 1}(z_{i - 1} - \mu_{i - 1}z_i + \mu_{i - 1}\mu_i c_{i+1}) +  2(h_{i} + h_{i - 1})(z_i - \mu_i c_{i+1}) + h_{i}c_{i + 1} = \alpha_{i-1},
$$
$$
 [h_{i - 1}\mu_{i - 1}\mu_i - 2(h_{i} + h_{i - 1}) \mu_i + h_{i}]c_{i+1} + h_{i - 1}z_{i - 1} - h_{i - 1}\mu_{i - 1}z_i + 2(h_{i} + h_{i - 1})z_i - \alpha_{i-1} = 0,
$$
данное соотношение будет выполнено, независимо от $c_{i + 1}$, если будут выполнены два следующих условия:
$$
h_{i - 1}\mu_{i - 1}\mu_i - 2(h_{i} + h_{i - 1}) \mu_i + h_{i} = 0,
$$
$$
h_{i - 1}z_{i - 1} - h_{i - 1}\mu_{i - 1}z_i + 2(h_{i} + h_{i - 1})z_i - \alpha_{i-1} = 0,
$$
откуда получаем
$$
\mu_i = \frac{h_i}{2(h_{i} + h_{i - 1}) - h_{i - 1}\mu_{i - 1} }
$$
$$
z_i = \frac{\alpha_{i-1}-h_{i - 1}z_{i - 1}}{ 2(h_{i} + h_{i - 1}) - h_{i - 1}\mu_{i - 1}},
$$
и, используя следующее соотношение
$$
h_i + h_{i - 1} = x_{i + 1} - x_{i - 1},
$$
введем еще один коэффициент
$$
l_i = 2 (x_{i + 1} - x_{i - 1}) - h_{i - 1}\mu_{i - 1}, \eqno(6)\
$$
окончательно получая
$$\mu_i = \frac{h_i}{ l_i},  \ \ z_i = \frac{\alpha_{i-1}-h_{i - 1}z_{i - 1}}{l_i}. \eqno(7)\
$$

\\
Теперь можем реализовать функцию для вычисления коэффициентов кубического сплайна в заданных узлах, используя формулы 2-7 и полагая, что $l_1 = l_n = 1, \ \mu_1 = \mu_n = 0$ и $z_1 = z_n = 0$. Листинг кода представлен ниже, все обозначения, приведенные выше, сохранены.


\\
\textbf{Функция} qubic_spline_coeff(x_nodes, y_nodes) \textbf{получает} на вход два параметра: списки с узлами x_nodes и значениями $f(x)$ в узлах y_nodes,  -- и \textbf{возвращает} матрицу  $(n - 1)\times4$, столбцами которой являются соответствующие векторы коэффициентов кубического сплайна. Матрица получается прутем применения метода np.c_[a, b, c , d] из модуля numpy. Данный метод осуществляет конкатенацию списков по столбцам, в результате чего в возвращаемой матрице в $i$-ой строке расположены коэффициенты $a_i, b_i, c_i, d_i$.
\begin{center}
    Листинг 1. Коэффициенты сплайна
\end{center}
\begin{minted}[frame=lines,
framesep=2mm,
baselinestretch=0.8,
fontsize=\footnotesize]{Python}
def qubic_spline_coeff(x_nodes, y_nodes):
    n = len(x_nodes)
    a = list(y_nodes)
    h = [x_nodes[i + 1] - x_nodes[i] for i in range(n - 1)] 
    
    alph = [3 / h[i] * (a[i + 1] - a[i]) 
         - 3 / h[i - 1] * (a[i] - a[i - 1]) for i in range(1, n - 1)]
    
    l = [1 for i in range(n)]
    mu = [0 for i in range(n - 1)]
    z = [0 for i in range(n)]
    
    for i in range(1, n - 1):
        l[i] = 2 * (x_nodes[i + 1] - x_nodes[i - 1]) - h[i - 1] * mu[i - 1]
        mu[i] = h[i] / l[i] 
        z[i] = (alph[i - 1] - h[i - 1] * z[i - 1]) / l[i]
        
    c = [0 for i in range(n)]
    b = [0 for i in range(n - 1)]
    d = [0 for i in range(n - 1)]
    
    for j in range(n - 1, 0, -1):
        c[j - 1] = z[j - 1] - mu[j - 1] * c[j]
        b[j - 1] = ((a[j] - a[j - 1]) / h[j - 1] 
                    - h[j - 1] * (c[j] + 2 * c[j - 1]) / 3)
        d[j - 1] = (c[j] - c[j - 1]) / 3 / h[j - 1]
        
    c.pop(-1)
    a.pop(-1)
    
    matr = np.c_[a, b, c, d]
    
    return matr
\end{minted}
\newpage
%----------------------------------------------------------
\subsection{Разработка функций вычисления значения кубического сплайна и его производной в заданной точке}

Получив матрицу с коэффициентами кубического сплайна из предыдущей функции, реализуем функцию вычисления значения кубического сплайна. По определению кубический сплайн существует только на промежутке $[x_0, x_n]$, где $x_0$ и $x_n$ -- граничные узлы интерполяции. Однако, как мы увидим далее при моделировании зашумленных данных и построении доверительной полосы, нам потребуется экстраполировать сплайн за границы указанного выше промежутка.

\\
Так как в задании не оговаривается выбор метода экстраполяции, то будем просто доопределять значения, используя коэффициенты для двух крайних промежутков. В итоге получим следующее условие на узлы, выходящие за границы интерполяции:
$$
S(x) = \begin{cases}
   a_1 + b_1(x - x_1) + c_1(x - x_1)^2 + d_1(x - x_1)^3, &\text{$x < x_1$}\\
   a_{n-1} + b_{n-1}(x - x_1) + c_{n-1}(x - x_1)^2 + d_{n-1}(x - x_1)^3, &\text{$x > x_n$}
 \end{cases}. \eqno(8)
$$

\\
Листинг кода функции, вычисляющей значение сплайна в данной точке, приведен ниже. \textbf{Функция} qubic_spline(x, x_nodes, qs_coeff)  \textbf{получает} на вход: точку x, в которой нужно найти значение сплайна, список значений х_nodes в заданных узлах и матрицу коэффициентами сплайна qs_coeff, -- \textbf{возвращает} значение сплайна в точке x.
\begin{center}
    Листинг 2. Значение сплайна в заданной точке
\end{center}
\begin{minted}[frame=lines,
framesep=2mm,
baselinestretch=0.8,
fontsize=\footnotesize]{Python}
def qubic_spline(x, x_nodes, qs_coeff):
    
    for i in range(len(x_nodes) - 1):
        if x <= x_nodes[i + 1]:
            break
            
    return (qs_coeff[i][0] + qs_coeff[i][1] * (x - x_nodes[i]) 
            + qs_coeff[i][2] * (x - x_nodes[i]) ** 2 
            + qs_coeff[i][3] * (x - x_nodes[i]) ** 3)   
\end{minted}

\\
В данной функции в цикле for происходит перебор всех промежутков, на которых определен кубический сплайн. Если значение выходит за пределы интерполируемого отрезка, то функция прерывается либо на самой первой итерации, либо доходит до конца, тем самым реализуется экстраполяция 8.

\\
Производная кубического сплайна в точке $x$:  $
S'(x) = b_i + 2c_i(x - x_i) + 3d_i(x - x_i)^2.
$

\\
Значения производной нет необходимости экстраполировать для дальнейшей работы.

\\
Листинг кода функции, вычисляющей значение производной кубического сплайна в заданной точке, представлен ниже. \textbf{Функция} d_qubic_spline(x, x_nodes, qs_coeff) \textbf{получает} на вход все то же самое, что и функция qubic_spline(x, x_nodes, qs_coeff), и \textbf{возвращает} значение производной сплайна в точке x.
\newpage
\begin{center}
    Листинг 3. Производная сплайна в заданной точке
\end{center}
\begin{minted}[frame=lines,
framesep=2mm,
baselinestretch=0.8,
fontsize=\footnotesize]{Python}
def d_qubic_spline(x, x_nodes, qs_coeff):
    
    for i in range(len(x_nodes) - 1):
        if x <= x_nodes[i+1]:
            return (qs_coeff[i][1] + 2 * qs_coeff[i][2] * (x - x_nodes[i]) 
                    + 3 * qs_coeff[i][3] * (x - x_nodes[i]) ** 2)
            
    return None 
\end{minted}

\\
В случае непопадания в промежуток функция возвращает None.
\newpage
%----------------------------------------------------------
\subsection{Построение аппроксимации по заданным узлам с помощью кубического сплайна}

У нас уже имеются все необходимые функции для построения графика сплайна по заданным узлам. Вычислим матрицу с коэффициентами, сгенерируем список из $n$ (в нашем случае возьмем $n$ = 201) точек, равномерно расположенных на отрезке $[0, 1]$, и по этому списку вычислим $n$ значений сплайна. Воспользуемся модулем matplotlib.pyplot и построим аппроксимацию по заданным узлам из таблицы 1 в виде графика, на котором отобразим также касательные в узлах $[x_2, x_{n -1}]$, демонстрируя работоспособность функции, вычисляющей производную сплайна (рис. 2).
\begin{center}
    Листинг 4. Построение сплайна
\end{center}
\begin{minted}[frame=lines,
framesep=2mm,
baselinestretch=0.7,
fontsize=\footnotesize]{Python}
n = 200
matr = qubic_spline_coeff(x_n, y_n)
x = [i / n for i in np.arange(0, n + 1)]
q = [qubic_spline(x[i], x_n, matr) for i in range(0, n + 1)]
\end{minted}

\\
Стоит отметить, что на графике отображены только $n - 2$ касательных к сплайну, так как, вообще говоря, для существования производной $S(x)$ в точке $x$ необходимо и достаточно наличие у $S(x)$ равных друг другу левой и правой производной в этой точке, то есть $S'(x) = S'_+(x) = S'_-(x)$. Но в силу того, что сплайн за границами интеполируемого отрезка не определен, то сказать что-то про производную слева для первого узла и производную справа для последнего узла мы точно не можем.
\begin{center}
\includegraphics[scale = 0.65]{labs/лаб1_база_1.png}
\\
Рисунок 2. Кубический сплайн, узлы и касательные в узлах
\end{center}


%----------------------------------------------------------
\subsection{Разработка функции вычисления значения i-го базисного полинома Лагранжа}
Приступим к реализации метода глобальной интерполяции на примере интерполяции полиномом Лагранжа. Базисный полином Лагранжа $n-1$ степени:
$$
l_i(x) = \prod\limits_{i = 1, i \neq j}^n\frac{x - x_j}{x_i - x_j}. \eqno(9)
$$

\\
Листинг функции представлен ниже. \textbf{Функция} l_i(i, x, x_nodes) \textbf{получает} на вход: номер полинома i, точку x, в которой нужно вычислить значение базисного полинома, и список x_nodes со значениями узлов, -- и \textbf{возвращает} значение $i$-го базисного полинома Лагранжа в заданной точке. Вычисление значения происходит в цикле for, где проверяется условие неравенства индексов $i$ и $j$ согласно формуле 9.
\begin{center}
    Листинг 5. Базисный полином Лагранжа
\end{center}
\begin{minted}[frame=lines,
framesep=2mm,
baselinestretch=0.8,
fontsize=\footnotesize]{Python}
def l_i(i, x, x_nodes):
    n = len(x_nodes)
    p = 1
    
    for j in range(n):
        if j != i:
            p *= (x - x_nodes[j]) / (x_nodes[i] - x_nodes[j])
            
    return p
\end{minted}
\newpage
%----------------------------------------------------------
\subsection{Разработка функции вычисления значения интерполяционного полинома Лагранжа}
\noindent\textbf{Опр.} Пусть функция $f(x) $ задана в  $n$ интерполяционных узлах $x_1,x_2,...,x_n$ на отрезке $[a, b]$, т.е. $x_1=a$ и $x_n=b$. Тогда интерполяционным полиномом для функции $ f(x)$ и соответствующих узлов интерполяции называется функция
$$
L_{n-1}(x) = \sum\limits_{i=1}^nf(x_i)l_i(x),
$$ 
где $l_i(x)$ - базисный полином Лагранжа.

\\
Листинг кода представлен ниже. \textbf{Функция} L(x, x_nodes, y_nodes) \textbf{получает} на вход: значение x, в котором нужно вычислить значение полинома Лагранжа, и списки с узлами x_nodes и значениями $f(x)$ y_nodes, -- \textbf{возвращает} значение полинома Лагранжа в точке х.
\begin{center}
    Листинг 6. Значение полинома Лагранжа в заданной точке
\end{center}
\begin{minted}[frame=lines,
framesep=2mm,
baselinestretch=0.8,
fontsize=\footnotesize]{Python}
def L(x, x_nodes, y_nodes):
    n = len(x_nodes)
    s = 0
    
    for i in range(n):
        s += y_nodes[i] * l_i(i, x, x_nodes)
    
    return s
\end{minted}
\\
Изобразим на одной плоскости получившийся полином для заданных узлов вместе с кубическим сплайном (рис. 3).

\begin{center}
\includegraphics[scale = 0.7]{labs/рунге.png}
\\
Рисунок 3. Полином Лагранжа (синяя кривая), кубический сплайн(рыжая кривая) и узлы 
\end{center}

\\
На рисунке отчетливо видно проявление так называемого феномена Рунге -- нежелательные осцилляции, возникающие при интерполировании полиномами высоких степеней. Это происходит из-за структуры базисных полиномов Лагранжа: на концах происходит скопление их экстремумов. В данном случае узлы, выбранные нами, расположены равномерно, а, как известно из лекций, для минимизации ошибки интерполяции Лагранжа стоит выбирать чебышевские узлы. Иными словами, при данных узлах из таблицы 1 мы не можем провести оптимальную интерполяцию полиномом Лагранжа, ошибка интерполяции будет неограниченно возрастать при увеличении числа узлов. Также отметим, что для 11 узлов полином Лагранжа будет иметь 10 степень, то есть выше, более чем в 3 раза, степени кубического сплайна.
\newpage
\subsection{Анализ влияния погрешности измерений}

\subsubsection{Часть 1. Погрешность измерений. Метод Монте-Карло}
Шумом будем называть погрешность, возникающую при измерениях в реальности. Для каждого метода интерполяции рассмотрим два случая. В первом случае зашумленными данными будут являться значения $x_i$, во втором -- значения $h_i$, представленные в таблице 1.

\\
Для каждого случая проведем 1000 экспериментов, в результате получим четыре семейства размером 1000, по два для каждого метода интерполяции. Описанные действия представляют собой метод Монте-Карло, или метод статистического моделирования, заключающийся в многократном повторении моделирования зашумленных данных для получения интервальной оценки интерполянтов, построенных на предположении о том, что в реальности при измерении значений в узлах существует некоторая неопределенность.

\\
Программно это будет реализовано следующим образом. Воспользуемся функцией np.random.normal(mu, sigma), в которую передадим указанные в задании параметры распределения случайной величины. Данная функция возвращает реализацию случайной величины, имеющей нормальное распределение. Сгенерируем два списка: зашумление по $x_i$ и зашумление по $h_i$. Листинг кода представлен ниже, в нем x_n и y_n -- соответствующие списки, хранящие значения из таблицы 1.
\begin{center}
    Листинг 7. Генерация списков с зашумленными данными
\end{center}
\begin{minted}[frame=lines,
framesep=2mm,
baselinestretch=0.8,
fontsize=\footnotesize]{Python}
mu, sigma = 0, 0.01
m, k = len(x_n), len(y_n)

x_generate = [[x_n[i] +  np.random.normal(mu, sigma) 
               for i in range(m)] for j in range(1000)]
h_generate = [[y_n[i] +  np.random.normal(mu, sigma) 
               for i in range(k)] for j in range(1000)]
\end{minted}

\\
Затем сгенерируем еще четыре списка: lx_generate, lу_generate, qx_generate и qy_generate. В них хранятся значения соответственно семейства полиномов Лагранжа с зашумлением $x_i$, полиномов Лагранжа с зашумлением $h_i$, кубических сплайнов с зашумлением $x_i$ и кубических сплайнов с зашумлением $h_i$.
\begin{center}
    Листинг 8. Генерация интерполянтов на основе зашумленных данных
\end{center}
\begin{minted}[frame=lines,
framesep=2mm,
baselinestretch=0.8,
fontsize=\footnotesize]{Python}
lx_generate = [[L(x[i], x_generate[j], y_n) 
                for i in range(0, n + 1)] for j in range(1000)]
ly_generate = [[L(x[i], x_n, h_generate[j]) 
                for i in range(0, n + 1)] for j in range(1000)]
qx_generate = [[qubic_spline(x[i], x_generate[j], qubic_spline_coeff(x_generate[j], y_n))
                for i in range(0, n + 1)] for j in range(1000)]
qy_generate = [[qubic_spline(x[i],  x_n, qubic_spline_coeff(x_n, h_generate[j]))
                for i in range(0, n + 1)] for j in range(1000)]
\end{minted}

\\
Построим полученные семейства интерполянтов (рис. 4 - 7).
\begin{center}
\includegraphics[scale = 0.57]{labs/лаб1_прод_1.png}
\\
Рисунок 4. Интерполяционные полиномы Лагранжа: семейство размером 1000, построенное на основе зашумленных данных (зашумлены значения $x_i$)
\vspace{\baselineskip}\vspace{\baselineskip}
\\
\includegraphics[scale = 0.57]{labs/лаб1_прод_2.png}
\\
Рисунок 5. Интерполяционные полиномы Лагранжа: семейство размером 1000, построенное на основе зашумленных данных (зашумлены значения $h_i$)
\\
\includegraphics[scale = 0.6]{labs/лаб1_прод_5.png}
\\
Рисунок 6. Кубические сплайны: семейство размером 1000, построенное на основе зашумленных данных (зашумлены значения $x_i$)
\vspace{\baselineskip}\vspace{\baselineskip}
\\
\includegraphics[scale = 0.6]{labs/лаб1_прод_6.png}
\\
Рисунок 7. Кубические сплайны: семейство размером 1000, построенное на основе зашумленных данных (зашумлены значения $h_i$)
\\
\end{center}
%----------------------------------------------------------

\subsubsection{Часть 2. Построение доверительной полосы и усредненного интерполянта}
Перейдем к построению доверительной полосы. Для начала определим, для чего вообще используется доверительная полоса, а затем рассмотрим один из способов ее построения.

\\
Доверительные полосы широко используются в статистическом анализе для демонстрации неопределенности в оценке какой-либо функции, построенной на основе зашумленных данных. Как описано ранее, для проведения подобного анализа было смоделировано 1000 векторов, включающих в себя определенную погрешность измерения.

\\
Отличие доверительной полосы от доверительного интервала состоит в том, что доверительные интервалы относятся к какой-то конкретной точке, в то время как доверительные полосы являются обобщением доверительного интервала и относятся уже к совокупности точек. Иными словами доверительная полоса -- ряд доверительных интервалов для какой-то последовательности выборок случайных величин из определенного распределения.

\\
В нашем случае доверительной полосой будет область, ограниченная функциями $h_l$ и $h_u$ снизу и сверху соответственно.

\\
Для того, чтобы проводить дальнейшие рассуждения, напомним некоторые понятия из статистики и теории вероятностей.

\\
Во всех определениях будем считать, что дано вероятностное пространство $(\Omega ,{\mathcal {F}},\mathbb {P} )$, и на нем определена случайная величина $X$ с распределением $\mathbb {P}^X$ [3].\\

\noindent\textbf{Опр.} Функция $F_X(x)$ называется функцией распределения случайной величины $X$ и задается следующей формулой
$$
F_{X}(x) = \mathbb {P} (X \leq x) = \mathbb {P}^X((-\infty, x]), \ F_{X}(x) \colon \mathbb {R} \to [0,1].
$$
\noindent\textbf{Опр.} Выборка $\textbf{X} = \{X_1, ..., X_n\}$ объема $n$ из закона распределения $\mathbb {P}^X$ -- набор из $n$ независимых случайных величин, имеющих распределение $\mathbb {P}^X$.
\vspace{\baselineskip}
\\
\noindent\textbf{Опр.} Статистика -- функция от выборки $\textbf{X}$.
\vspace{\baselineskip}
\\
\noindent\textbf{Опр.} Набор $X_{(1)} \leq  X_{(2)} \leq ... \leq X_{(n)}$ упорядоченных по возрастанию компонент выборки $(X_1, ..., X_n)$ называется вариационным рядом, а сами случайные величины $X_{(k)}$ -- k-ми порядковыми статистиками.
$$
X_{(1)} = \min\{X_1, ..., X_n\};
$$$$
X_{(2)} = \max\{\min\{X_1, ..., X_{i - 1}, X_{i + 1}, ..., X_n\}\};
$$
\begin{center}
    ...
\end{center}
$$
X_{(n)} = \max\{X_1, ..., X_n\}.
$$
\noindent\textbf{Опр.} Две статистики $\hat{\theta}_1$ и $\hat{\theta}_2$ определяют границы доверительного интервала параметра $\theta$ с коэффициентом доверия $1 - p, \ p \in (0,1)$, если $\forall \theta \in \Theta$ для выборки $\textbf{X} = \{X_1, ..., X_n\}$ из закона распределения $\mathbb {P}^X$ справедливо равенство
$$
\mathbb{P}\left(\hat{\theta}_1(\textbf{X}) \leq \theta \leq \hat{\theta}_2(\textbf{X})\right) = 1 - p.
$$
\noindent\textbf{Опр.} Пусть фиксировано $\alpha \in (0, 1)$, тогда $\alpha-$квантилем распределения $\mathbb{P}^X$ называется число $x_{\alpha} \in \mathbb{R}$, такое что
$$
\mathbb{P}(X \leq x_{\alpha}) \geq \alpha.
$$
\textbf{Опр.} Пусть дана выборка $(X_1, ..., X_n)$ объема $n$, порожденная случайной величиной $X$ с функцией распределения $F(x)$, тогда случайная величина $F_n(x)$ называется эмпирической функцией распределения и задается следующим образом
$$
F_n(x) = \sum\limits_{i = 1}^n\mathbf{1}_{\{X_i \leq x\}}, \ \mathbf{1}_{\{X_i \leq x\}} = \begin{cases}
   1, &\text{$X_i \leq x$}\\
   0, &\text{$X_i > x$}
 \end{cases}.
$$

\\
В нашем случае каждый интерполянт был построен по 201 точке. Соответственно, имеем 201 выборку $X^1, ..., X^{201}$ размера 1000, $X^i = (X^i_1, ..., X^i_{1000})$. Согласно условию задачи необходимо найти такой интервал, что вероятность попадания в него значения интерполянта в точке $x$ равна 0.9. Иначе говоря, для каждой выборки ставится следующая задача:
$$
\mathbb{P}(\tilde h^i_l(x) \leq X^i \leq \tilde h^i_u(x)) = 0.9.
$$

\\
Убедимся, что вся 201 выборка является выборкой из непрерывного распределения. Для обоснования этого утверждения будем рассматривать полином Лагранжа и кубический сплайн для какого-то фиксированного $x \in [0,1]$. Отсюда имеем для интерполяции полиномом Лагранжа $L_{10}(\xi_1, ..., \xi_{11})$ -- функцию от вектора непрерывных случайных величин и для кубического сплайна $S_i(\xi_i), i \in [1, 10]$ -- функцию от непрерывной случайной величины (для каждого промежутка сплайна своя случайная величина), при зашумлении $h_i$, и функцию от вектора непрерывных случайных величин $S(\xi_1, ..., \xi_n)$, при зашумлении $x_i$, где $\xi_i  \sim N\left(0, \frac{1}{100}\right)$. Далее как полином Лагранжа, так и кубический сплайн (учитывая экстраполяцию 8) являются непрерывными функциями, значит, по \textit{теореме о непрерывности сложной функции} интерполянты Лагранжа и кубические cплайны, смоделированные при помощи зашумления исходных данных непрерывной случайной величиной, также будут непрерывными случайными величинами (при фиксированном $x$). Тогда вся 201 выборка для обоих интерполяционных методов будет выборкой из абсолютно непрерывного распределения.

\\
Исходя из рассуждений выше для абсолютно непрерывного распределения можем пользоваться тем, что $F_X(x_{\alpha}) = \alpha, \ x_{\alpha}$ -- $\alpha-$квантиль (по определениям квантиля и функции распределения).

\\
Теперь произведем некоторые алгебраические действия:
$$
\alpha = \frac{1 + \alpha}{2} - \frac{1 - \alpha}{2} = F\left(x_{\frac{1 + \alpha}{2}}\right) - F\left(x_{\frac{1 - \alpha}{2}}\right) = \mathbb{P}\left(x_{\frac{1 + \alpha}{2}} \leq X^i \leq x_{\frac{1 + \alpha}{2}}\right).
$$

\\
Для каждой выборки имеем свою эмпирическую функцию распределения. Оценим $\alpha-$квантиль методом подстановки, полагая, что если $\phi(F_X) = x_{\alpha}$, то $\phi(F_n) = \hat{x}_{\alpha}$. Из этих соображений несложно построить оценку квантиля следующим образом.
$$
k = \left\lfloor \alpha \cdot (n - 1) \right\rfloor, \ \ x_{\alpha} = \begin{cases}
   X^i_{(k + 1)}, &\text{$k + 1 < \alpha n$}\\ \\
   \frac{X^i_{(k)} + X^i_{(k + 1)}}{2},  & \text{$k + 1 = \alpha n$} \\
   X^i_{(k)}, &\text{$k + 1 > \alpha n$}
 \end{cases}
$$

\\
Нам необходимы квантили $x_{\frac{1 - \alpha}{2}}$ и $x_{\frac{1 + \alpha}{2}}$. Рассчитаем, каким $k$-порядковым статистикам они равны. 
$$
k_1 = \left\lfloor \frac{1 - \alpha}{2} \cdot (n - 1) \right\rfloor = \left\lfloor \frac{1 - 0.9}{2} \cdot (1000 - 1) \right\rfloor = \left\lfloor 0.05 \cdot (999) \right\rfloor = \left\lfloor 49.95 \right\rfloor = 49,
$$
$$
k_1 + 1 = 50 = \frac{1 - 0.9}{2} \cdot 1000 \Rightarrow x_{\frac{1 - \alpha}{2}} =  \frac{X^i_{(49)} + X^i_{(50)}}{2},
$$
$$
k_2 = \left\lfloor \frac{1 - \alpha}{2} \cdot (n - 1) \right\rfloor = \left\lfloor \frac{1 + 0.9}{2} \cdot (1000 - 1) \right\rfloor = \left\lfloor 0.05 \cdot (999) \right\rfloor = \left\lfloor 949.05 \right\rfloor = 949,
$$
$$
k_2 + 1 = 950 = \frac{1 + 0.9}{2} \cdot 1000 \Rightarrow x_{\frac{1 + \alpha}{2}} =  \frac{X^i_{(949)} + X^i_{(950)}}{2}.
$$

\\
Программно поиск соответствующих порядковых статистик реализован с помощью сортировки списков, в каждом из которых хранится 1000 значений для всей 201 точки, по которым происходили построения графиков. Затем для каждого списка длины 1000 берем значения с индексами 48 и 49, суммируем и делим на 2. Получаем квантиль, по которому будет построена кривая $h_l$. Затем берем значения с индексами 948 и 949 и также делим их сумму на 2. Получаем квантиль, по которому будет построена кривая $h_u$. Усредненный интерполянт будем искать, находя выборочное среднее. 
\begin{center}
    Листинг 9. Построение доверительной полосы и поиск усредненного интерполянта
\end{center}
\begin{minted}[frame=lines,
framesep=2mm,
baselinestretch=0.8,
fontsize=\footnotesize]{Python}
def conf_band(y, n):
    y_ = y.transpose()
    for i in range(n + 1):
        y_[i].sort()
        
    h_l = [(y_[i][48] + y_[i][49]) / 2 for i in range(n + 1)]
    h_m = [sum(y_[i]) / 1000 for i in range(n + 1)]
    h_u = [(y_[i][948] + y_[i][949]) / 2 for i in range(n + 1)]
    
    return [h_l, h_m, h_u]
\end{minted}

\\
\textbf{Функция} conf_band(y, n) \textbf{принимает} на вход матрицу вида 
$
\left(
    \begin{array}{c c c}
    x_1^1 & ... & x^m_1
    \\
    \vdots & ... &\vdots 
    \\
    x^1_n & ... & x^m_n
    \end{array}
    \right)
$, где $m$ - число выборок, а $n$ - количество элементов выборки. В нашем случае $m = 201, n = 1000$. Для построения доверительной полосы нужно брать столбцы матрицы и производить построение вариационного ряда, программно -- сортировку списка, в котором содержатся значения $i$-го столбца, $i \in [1, 201]$. Как видно, нам было бы удобнее, чтобы столбцы матрицы были ее строками, чтобы осуществлять перебор по выборкам в цикле. Поэтому мы транспонируем переданную в функцию матрицу, чтобы она приняла вид
$
\left(
    \begin{array}{c c c}
    x_1^1 & ... & x^1_n
    \\
    \vdots & ... &\vdots 
    \\
    x^m_1 & ... & x^m_n
    \end{array}
    \right)
$ и затем уже осуществляем проход по ее строкам с сортировкой каждого списка из строки. Функция \textbf{возвращает} матрицу $3\times(n - 1)$ в виде списка.
В результате получаем графики, приведенные ниже (рис. 8, 9, 10, 11).
\begin{center}
\includegraphics[scale = 0.6]{labs/лаб1_прод_3.png}
\\
Рисунок 8. Доверительная полоса для выборки полиномов Лагранжа, построенной на основе зашумленных данных (зашумлены значения $x_i$). Зеленая кривая -- $h_u$, синяя кривая -- $h_l$, рыжая кривая - усредненный интерполянт
\\
\includegraphics[scale = 0.58]{labs/лаб1_прод_4.png}
\\
Рисунок 9. Доверительная полоса для выборки полиномов Лагранжа, построенной на основе зашумленных данных (зашумлены значения $h_i$). Зеленая кривая -- $h_u$, синяя кривая -- $h_l$, рыжая кривая - усредненный интерполянт
\vspace{\baselineskip}\vspace{\baselineskip}
\\
\includegraphics[scale = 0.58]{labs/лаб1_прод_7.png}
\\
Рисунок 10. Доверительная полоса для выборки кубических сплайнов, построенной на основе зашумленных данных (зашумлены значения $x$). Зеленая кривая -- $h_u$, синяя кривая -- $h_l$, рыжая кривая - усредненный интерполянт
\\
\includegraphics[scale = 0.6]{labs/лаб1_прод_8.png}
\\
Рисунок 11. Доверительная полоса для выборки кубических сплайнов, построенной на основе зашумленных данных (зашумлены значения $h$). Зеленая кривая -- $h_u$, синяя кривая -- $h_l$, рыжая кривая - усредненный интерполянт
\end{center}
\newpage
\subsubsection{Часть 3. Анализ влияния погрешностей на результаты интерполяции}
\\
Для проведения анализа влияния погрешностей на интерполяцию  воспользуемся модулем pandas. С помощью него создадим таблицы, в которых будут храниться значения полученных кривых для доверительной полосы, значения усредненных интерполянтов и значения интерполянтов, вычисляемых при условии, что данные не были зашумлены.

\\
Проанализируем, какие участки каждого интерполянта являются наиболее чувствительны к погрешностям. 

\\
Начнем с полинома Лагранжа. 

\begin{center}
Таблица 2: Доверительные полосы для полинома Лагранжа, первая 21 точка
\includegraphics[scale = 0.8]{labs/голова2.png}
\end{center}

\\
В таблице 2 представлена следующая информация: в столбце ``Лагранж, х, hl'' -- нижняя граница доверительной полосы при зашумленных $x_i$, ``Лагранж, h, hl'' -- нижняя граница доверительной полосы при зашумленных $h_i$, ``Лагранж, x, hu'' и ``Лагранж, h, hu'' -- верхние границы, ``x'' -- данные $x$.

\\
Оценим верхнюю границу погрешности, привносимой шумом. Возьмем максимальную по модулю $Z$ из всех, что были прибавлены к $x_i$:
$$
\tilde L_{10} = \sum\limits_{i=1}^{10} f(x_i)\prod\limits_{i = 1, i \neq j}^n\frac{x - x_j + |Z|}{x_i - x_j}, \ |L_{10} - \tilde L_{10}| < C|Z|^{10}.
$$

\\
То есть при зашумлении $x_i$ максимальная абсолютная погрешность для полинома Лагранжа имеет верхнюю оценку, пропорциональную $|Z|^{10}$ ($C$ - какая-то константа). Теперь оценим абсолютную погрешность при зашумлении $h_i = f(x_i)$:
$$
\tilde L_{10} = \sum\limits_{i=1}^{10} (f(x_i) + |Z|)\prod\limits_{i = 1, i \neq j}^n\frac{x - x_j}{x_i - x_j}, \ |L_{10} - \tilde L_{10}| < C|Z|.
$$

\\
Здесь уже верхняя оценка абсолютной погрешности гораздо меньше, так как мы просто изменяем линейный параметр. Посмотрим, что происходит с кубическим сплайном.
\begin{center}
Таблица 3: Доверительные полосы для кубического сплайна, первая 21 точка
\includegraphics[scale = 0.8]{labs/голова3.png}
\end{center}

\\
В таблице 3 представлена следующая информация: в столбце ``Сплайн, х, hl'' -- нижняя граница доверительной полосы при зашумленных $x_i$, ``Сплайн, h, hl'' -- нижняя граница доверительной полосы при зашумленных $h_i$, ``Сплайн, x, hu'' и ``Сплайн, h, hu'' -- верхние границы, ``x'' -- данные $x$.

\\
Будем полагать $|Z|$ такой же как и в случае выше с полиномом Лагранжа:
$$
x_i - |Z|, \ x_{i + 1} + |Z|,  \ h_i = x_{i + 1} - x_i + 2|Z| ,
$$
$$
(h_{i - 1} + 2|Z|)c_{i-1} +  2(h_{i} + h_{i - 1} + 4|Z|)c_i + (h_{i} + 2|Z|)c_{i + 1} =  \frac{3}{h_{i - 1} + 2|Z|}(a_i - a_{i  - 1}) - \frac{3}{h_{i - 2} + 2|Z|}(a_{i - 1} - a_{i - 2}),
$$
раз для нашего случая узлы расположены равномерно, то $h_{i - 2} = h_{i - 1} = h_i \forall i \in [1, n]$ и пусть $h_i + 2|Z| = \Delta$, 

$$
\Delta c_{i-1} +  4\Delta c_i + \Delta c_{i + 1} = \frac{3}{\Delta}(a_i - a_{i  - 1}) - \frac{3}{\Delta}(a_{i - 1} - a_{i - 2}),
$$
$$
c_{i-1} +  4 c_i +  c_{i + 1} = \frac{3}{\Delta^2}(a_i - a_{i  - 1}) - \frac{3}{\Delta^2}(a_{i - 1} - a_{i - 2}),
$$
$$
\tilde c_i = -4 c_i - c_{i - 1} + \frac{3}{\Delta^2}(a_i - a_{i  - 1}) - \frac{3}{\Delta^2}(a_{i - 1} - a_{i - 2}),
$$
$$
\left|\frac{1}{\Delta^2} - \frac{1}{h_i ^2}\right| =\left| \frac{4|Z|^2 + 4|Z| + h_i^2 - h_i^2}{4|Z|^2h_i^2 + 4|Z|h_i^2 + h_i^4}\right| = \left| \frac{1}{h_i^2} \cdot \left(1 -  \frac{h^2_i}{4|Z|^2 + 4|Z| + h_i^2} \right) \right| < \frac{C_}{|Z|^2}  \ \Rightarrow |c_i - \tilde c_i| < \frac{C_1}{|Z|^2},
$$
$$
\tilde d_i = \frac{ \tilde c_{i+1} - \tilde c_i}{3\Delta}  \ \Rightarrow |d_i - \tilde d_i| < \frac{C_2}{|Z|^3}
$$

$$
\tilde b_i = \frac{1}{\Delta}(a_{i+1} - a_i) - \frac{\Delta}{3}(c_{i + 1} + 2c_i) \ \Rightarrow |b_i - \tilde b_i| < \frac{C_3}{|Z|}, \ \ C, C_1, C_2, C_3 = const.
$$


\\
Мы рассмотрели оценки коэффициентов сплайна, теперь рассмотрим абсолютную погрешность для значения сплайна при зашумлении $x_i$:
$$
\left| S_i(x) - \tilde S_i(x)\right| < \left|\frac{C_3}{|Z|}(x - x_i)\right| + |\tilde b_i |Z|| + \left|\frac{C_1}{|Z|^2}(x - x_i)^2\right|(x - x_i)^2 + |\tilde c_i |Z|^2|+ \left|\frac{C_2}{|Z|^3}(x - x_i)^3\right| + |\tilde d_i |Z|^3| < \frac{C_4}{|Z|}.
$$

\\
Переобозначим $h_i$ -- зашумляемые значения, через $f(x_i) = a_i$ и посмотрим, что будет происходить со сплайном в этом случае.
$$
h_{i - 1}c_{i-1} +  2(h_{i} + h_{i - 1})c_i + h_{i}c_{i + 1} =  \frac{3}{h_{i - 1}}(a_i - a_{i  - 1} + 2|Z|) - \frac{3}{h_{i - 2}}(a_{i - 1} - a_{i - 2} + 2|Z|), 
$$
$$
|c_i - \tilde c_i| < C_1|Z|, 
$$
$$
|b_i - \tilde b_i| < C_2|Z|,
$$
$$
|d_i - \tilde d_i| < C_3|Z|, 
$$
$$
|S_i(x) - \tilde S_i(x)| < C_4|Z|, \ C_1, C_2, C_3, C_4 = const.
$$

\\
Как видим, верхняя оценка абсолютной погрешности для сплайна при зашумлении $x_i$ пропорциональна $\frac{1}{|Z|}$, а при зашумлении $h_i$ пропорциональна $|Z|$. Учитывая, что $|Z|$ это случайная величина $\sim N(0, \frac{1}{100})$, по \textit{закону трех сигм} вероятность того, что случайная величина отклонится от своего математического ожидания более чем на три среднеквадратических отклонения, больше, чем 0.99. В нашем случае $\mathbb {P}(-\frac{3}{100} \leq Z \leq \frac{3}{100}) > 0.99$. Поэтому на графике для зашумленных $x_i$ наблюдаем более широкую доверительную полосу, чем на графике для зашумленных $h_i$ -- $\frac{1}{|Z|}$ в нашем случае получается в среднем больше, чем $|Z|$.

\\
Обратимся к графикам (рис. 10, 11): доверительные полосы для кубического сплайна имеют примерно одинаковую ширину на всем промежутке, гораздо более стабильную, чем у полиномов Лагранжа. Это можно объяснить тем, что в случае локальной интерполяции шумовая погрешность влияет на все промежутки независимо и примерно в равной степени. В то время как при глобальной интерполяции (рис. 8, 9) промежуток всего один и ближе к концам наблюдается эффект Рунге, поэтому шум влияет на глобальный интерполянт не равномерно. То же самое можем увидеть, обратясь к таблицам 2 и 3. При приближении к центральным узлам доверительная полоса для глобальной интерполяции становится все уже, в то время как для локальной остается примерно одинаковой.

\\
Теперь сравним усредненные интерполянты и "истинные". Посмотрим первые 15 точек.
\begin{center}
Таблица 4: Усредненные интерполянты, первые 15 точек
\includegraphics[scale = 1]{labs/голова1.png}
\end{center}

\\ 
В таблице 2 представлена следующая информация: в столбце ``Лагранж, х'' находятся значения усредненного интерполянта при зашумленных данных $x_i$, в столбце ``Лагранж,  h'' -- значения усредненного интерполянта при зашумленных $h_i$, в столбце ``Лагранж'' -- значения синтерполянта без зашумления. Аналогично для сплайна.


\\
Так как моделируемая погрешность является случайной величиной с нулевым математическим ожиданием, то в среднем абсолютное отклонение истинного значения интеполянта от усредненного должно быть почти наверное равно нулю (при размере выборки, стремящимся к бесконечности). Как видно из таблицы 2 для полинома Лагранжа при зашумленных данных $x_i$ отклонение среднего выборочного от матожидания больше, чем при зашумленных данных $h_i$. 

\\
Посчитаем среднее значение абсолютного отклонения среднего выборочного от матожидания для всей совокупности из 201 выборки для каждого из четырех случаев.
$$
\bar \Delta = \frac{1}{m} \sum\limits_{i = 1}^m |\bar f(x_i) - f(x_i)|.
$$.

\\
Для нашего случая $m = 201$. В результате для четырех столбцов из таблицы получаем
\begin{center} 
Таблица 5: Значения средних абсолютных отклонений среднего выборочного от математического ожидания
\label{table1}\begin{tabular}
{| c | c | c | c | c |}
\hline
функция & $L_x$ & $L_h$ & $S_x$ & $S_h$  \\ \hline
погрешность & 0.0248402 & 0.0013058 & 0.00136555 & 0.0001726 \\
\hline
\end{tabular}
\end{center}

\\
В таблице 5 нижние индексы у $L$ и $S$ означают зашумляемые данные. Можем видеть, что наибольшая погрешность наблюдается при зашумлении $x_i$ для полинома Лагранжа, а наименьшая при зашумлении $h_i$ для кубического сплайна. Такие отклонения можно объяснить все теми же рассуждениями, приведенными выше, в которых рассматривались верхние оценки абсолютной погрешности. Однако, стоит отметить, что среднее абсолютное отклонение выборочного среднего от матожидания все же невелико. Такой эффект наблюдается за счет того, что случайная величина имеет сравнительно малую меру разброса, как уже отмечалось выше, поэтому все усредненные интерполянты сосредоточены в достаточно малой окрестности своих истинных значений.

%----------------------------------------------------------
\newpage
\subsection{Заключение}
В результате проведенного анализа и проделанной работы можем сделать следующие выводы.

\begin{enumerate}
	\item Неопределенность исходных данных влияет на глобальную и локальную интерполяцию по-разному. В первом случае в результате эффекта Рунге происходят сильные отклонения от среднего на краях отрезка интерполяции, но ближе к середине доверительная полоса сужается. Во втором случае неопределенность относительно равномерно влияет на интерполяцию и доверительная полоса сохраняет примерно одинаковую ширину на всем отрезке интерполяции.
	\item Наиболее сильные отклонения от среднего при глобальной интерполяции наблюдаются при зашумлении данных $x_i$, это можно объяснить высокой степенью (пропорциональна степени интерполяционного полинома) верхней оценки абсолютной погрешности интерполяции. В то время как отклонения при зашумлении $h_i$ являются небольшими, что опять же объясняется малой степенью верхней оценки абсолютной погрешности.
	\item Для локальной интерполяции ситуация складывается аналогично, однако там уже подобное явление связано с тем, какие значения может принимать моделируемая случайная величина, что было показано во 3 части 9 пункта данной работы.
	\item Для малого количества узлов лучше использовать интерполяцию полиномом Лагранжа, так как она требует меньше затрат на вычисления. Однако локальная интерполяция кубическими сплайнами более устойчива к погрешностям, при большом количестве узлов (а особенно равномерно расположенных) лучше использовать ее.
	
\end{enumerate}
